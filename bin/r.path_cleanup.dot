# clean up, derive and expand some paths described by environment variables
# derive EC_LD_LIBRARY_PATH and EC_INCLUDE_PATH
# expand PATH, EC_LD_LIBRARY_PATH and EC_INCLUDE_PATH
# clean up PATH MANPATH LD_LIBRARY_PATH LD_RUN_PATH PYTHONPATH TCL_LIBRARY LIBPATH SSM_INCLUDE_PATH EC_INCLUDE_PATH EC_LD_LIBRARY_PATH`
#
  [[ "$1" == --verbose ]] && VerboseCleanupActive="--verbose"
# [[ -z $NoBinBump ]] && PATH=/bin:/usr/bin:$PATH   # keep duo just below ovbin directories

  [[ "${FIX_THE_PATHS:-true}" == true ]] && export FIX_THE_PATHS=$(which r.fix_the_paths 2>/dev/null)
  [[ -z ${FIX_THE_PATHS} ]] && make_fix_the_paths
  [[ -z ${FIX_THE_PATHS} ]] && export FIX_THE_PATHS=$(which r.fix_the_paths 2>/dev/null)
  if [[ -z ${FIX_THE_PATHS} ]] ; then
    echo "WARNING: r.fix_the_paths not found, cleanup/optimization disabled"
    export FIX_THE_PATHS=true
  fi

  eval $(${FIX_THE_PATHS} ${VerboseCleanupActive} +${ORDENV_PLAT}+${BASE_ARCH} PATH MANPATH LD_LIBRARY_PATH LD_RUN_PATH PYTHONPATH TCL_LIBRARY LIBPATH SSM_INCLUDE_PATH SSM_LIB_PATH SSM_SHORTCUT_PATH)
#
  export MANPATH="${MANPATH}:"  # keep honoring default MANPATH
#
# derive base EC_INCLUDE_PATH from SSM_INCLUDE_PATH
  export EC_INCLUDE_PATH="$(echo $SSM_INCLUDE_PATH | sed 's/:/ /g') "
#
# derive base EC_LD_LIBRARY_PATH from SSM_INCLUDE_PATH (deprecated)
#  export EC_LD_LIBRARY_PATH="$(echo $LD_LIBRARY_PATH | sed 's/:/ /g')"
#  export EC_LD_LIBRARY_PATH="$(echo ${SSM_INCLUDE_PATH}: | sed -e 's%/include:%/lib %g' -e 's%/include/%/lib/%g' -e 's/:/ /g' ) "
#
# derive base EC_LD_LIBRARY_PATH from SSM_LIB_PATH (derived from SSM_INCLUDE_PATH if absent)
  [[ -z $SSM_LIB_PATH ]] && export SSM_LIB_PATH="$(echo ${SSM_INCLUDE_PATH}: | sed -e 's%/include:%/lib %g' -e 's%/include/%/lib/%g')"
  export EC_LD_LIBRARY_PATH="$(echo $SSM_LIB_PATH | sed 's/:/ /g') "
#
# cleanup and expansion for EC_INCLUDE_PATH and EC_LD_LIBRARY_PATH (used later by s.compile and consorts)
  COMP_ARCH=${COMP_ARCH:-${EC_ARCH#${BASE_ARCH}}}    # in case it is not defined
  COMP_ARCH=${COMP_ARCH#/}
  eval $(${FIX_THE_PATHS} ${VerboseCleanupActive} +${ORDENV_PLAT}/${COMP_ARCH}+${COMP_ARCH}+${EC_ARCH} EC_INCLUDE_PATH +${ORDENV_PLAT}/${COMP_ARCH}+${COMP_ARCH}+${EC_ARCH} EC_LD_LIBRARY_PATH)
#
unset VerboseCleanupActive
